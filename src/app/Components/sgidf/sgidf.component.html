<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12 col-md-12 col-lg-12 bg-primary mt-2" *ngIf="error==true">
      <p>
        {{errorMsg}}
      </p>
    </div>
    <div class="col-sm-12 col-md-12 col-lg-12 bg-black mt-2" style="display: block; position:relative">
      <mat-form-field>
        <mat-label>Please choose the required forms to display:</mat-label>
        <mat-select [(ngModel)]="selectedValue" (ngModelChange)="nameChanged($event)" ngModel name="sgidfForm">
          <mat-option *ngFor="let sgidfForm of sgidfForms" [value]="sgidfForm.value">
            {{sgidfForm.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button class="btn btn-primary" (click)="addNewElem()" style="margin-left: 2%; margin-right: 2%;">Add new
        Forms</button>
      <mat-form-field *ngIf="show==true">
        <mat-label>Attach:</mat-label>
        <mat-select [(ngModel)]="attachVal" (ngModelChange)="updateAttachVal($event)" ngModel name="sgidfForm">
          <mat-option *ngFor="let attachForm of attachForms" [value]="attachForm.value">
            {{attachForm.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field *ngIf="show==true">
        <mat-label>Attached:</mat-label>
        <mat-select [(ngModel)]="attachedVal" (ngModelChange)="updateAttachedVal($event)" ngModel name="sgidfForm">
          <mat-option *ngFor="let attachedForm of attachedForms" [value]="attachedForm.value">
            {{attachedForm.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button type="button" *ngIf="show==true" class="btn btn-primary" (click)="attach()"
        style="margin-left: 2%;">Attach</button>

      <mat-form-field *ngIf="detachState==true" style="margin-left: 2%;">
        <mat-label>Detach:</mat-label>
        <mat-select [(ngModel)]="dettachedVal" (ngModelChange)="updateDettachedVal($event)" ngModel name="sgidfForm">
          <mat-option *ngFor="let dettachTrack of dettachTracks" [value]="dettachTrack">
            {{dettachTrack}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button type="button" *ngIf="detachState==true" class="btn btn-primary" (click)="detach()"
        style="margin-left: 2%;">Detach</button>
    </div>

    <div #parent id="parentdiv" class="" style="border:solid; display: block; position:relative">
      <div class="container-fluid">
        <div class="row">
          <!-- this div will later include all the inserted forms -->
          <div>
            <!-- Create Identity -->
            <div #createIdentityElement class="createIdentityElement col-sm-2 col-md-4 col-lg-3 bg-primary mt-2" cdkDrag
              (cdkDragMoved)="updatePosition()" cdkDragBoundary=".parentdiv-boundary">
              <form [formGroup]="createFullIdentity" (ngSubmit)="createNewUser(createFullIdentity)" novalidate>
                <h4 class="titleCreateIdentity"> Create identity</h4><hr>
                <!-- Create Identity Profile-->
                <div>
                  <!-- Form group Profile -->
                  <div formGroupName="profile">
                    <h4>1- Profile</h4>
                    <p>
                      <label for="formGroupExampleInput" class="form-label">First name: &nbsp;</label>
                      <input type="text" name="profileFirstName" formControlName="firstName" class="input-Form">
                      <label for="formGroupExampleInput" class="form-label">Last name: &nbsp;</label>
                      <input type="text" name="profileLastName" formControlName="lastName" class="input-Form">
                    </p>
                    <p>
                      <label for="formGroupExampleInput" class="form-label">civility: &nbsp;</label>
                      <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example"
                        formControlName="civility">
                        <option *ngFor="let civility of civilitys" [ngValue]="civility.id"> {{civility.name}} </option>
                      </select>
                      &nbsp;&nbsp;
                      <label for="formGroupExampleInput" class="form-label">Gender: &nbsp;</label>
                      <select class="form-select form-select-lg mb-2" aria-label=".form-select-lg example"
                        formControlName="gender">
                        <option *ngFor="let gender of genders" [ngValue]="gender.id"> {{gender.name}} </option>
                      </select>
                      &nbsp;&nbsp;
                      <label for="formGroupExampleInput" class="form-label">BirthDay:&nbsp;</label>
                      <input type="date" name="profileBirthDate" formControlName="birthdate" class="input-Form">
                    </p>
                  </div>

                  <div formGroupName="password">
                    <p>
                      2- Mot de passe:&nbsp;
                      <input type="password" formControlName="value" name="identitypassword" class="input-Form">
                    </p>
                  </div>

                  <!-- Form group contactIdentifiers -->

                  <div formArrayName="getIdentifiersForm">
                    <div *ngFor="let identifierForm of getIdentifiersForm.controls; let i = index">
                      <div class="lesson-form-row" [formGroup]="identifierForm">
                        <h4>3-identifiers</h4>
                        <p>
                          <label selected>identifierType: &nbsp;</label>
                          <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" formControlName="type">
                            <option *ngFor="let identifierType of identifierTypes" [ngValue]="identifierType.name"> {{identifierType.name}} </option>
                          </select>
                          &nbsp;&nbsp;
                          Value:&nbsp;
                          <input type="text" formControlName="value" class="input-Form">
                          &nbsp;&nbsp;
                          Provider&nbsp;
                          <input type="text" formControlName="provider" class="input-Form">
                        </p>
                      </div>
                      </div>
                    </div>
                  </div>

                  <div formArrayName="getConcatIdentifiers">
                    <h4>4-Contact Identifiers</h4>
                     <div *ngFor="let contactForm of getConcatIdentifiers.controls; let i = index">
                      <div class="lesson-form-row" [formGroup]="contactForm">
                        <p>
                          <label selected>ContactidenfierType: &nbsp;</label>
                          <select  class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" formControlName="type">
                            <option *ngFor="let contactIdentifierType of contactIdentifierTypes" [ngValue]="contactIdentifierType.name"> {{contactIdentifierType.name}} </option>
                          </select>
                          &nbsp;&nbsp;
                          Value: 
                          <input type="text" formControlName="value" class="input-Form">
                        </p>
                      </div>
                    </div>
                  </div><hr>
                <div class="col-6 mx-auto">
                  <button class="btn btn-info">Create identity</button>
                </div>
              </form>
            </div>

            <!-- CRUD Contact Identifiers Email/Mobile -->
            <div #contactIdentifiersElement class="col-sm-2 col-md-4 col-lg-3 mr-2 ml-2 bg-primary" cdkDrag
              (cdkDragMoved)="updatePosition()" cdkDragBoundary=".parentdiv-boundary">
              <form [formGroup]="contactIdentifiersForms" (ngSubmit)="contactIdentifiersFn(contactIdentifiersForms)"
                novalidate>
                <h4 class="titleCreateIdentity">Get Contact Identifier</h4>
                <hr>
                <h4>Select action: </h4>
                <p>
                  <input type="radio" name="action" (cheked)="setAction('update')" (change)="setAction('update')"
                    class="input-radio"> Update contact Identifier <br>
                  <input type="radio" name="action" (cheked)="setAction('add')" (change)="setAction('add')"
                    class="input-radio"> Add contact Identifier <br>
                  <input type="radio" name="action" (cheked)="setAction('delete')" (change)="setAction('delete')"
                    class="input-radio"> Delete contact Identifier <br>
                </p>
                <div>
                  <p>
                    <input type="checkbox" id="isPassword" name="isPassword" formControlName="isPassword"
                      class="input-radio">
                    <label for="formGroupExampleInput" class="form-label">Password</label>
                  </p>
                  <p>
                    <label>ContactidenfierType: &nbsp;</label>
                    <select  class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" formControlName="type">
                      <option *ngFor="let contactIdentifierType of contactIdentifierTypes" [ngValue]="contactIdentifierType.name"> {{contactIdentifierType.name}} </option>
                    </select>
                    Value: &nbsp;
                    <input type="email" formControlName="value" class="input-Form">
                  </p>
                </div>
                <div class="col-6 mx-auto">
                  <button type="submit" class="btn btn-info">Update status</button>
                </div>
              </form>
            </div>

            <!-- CRUD get Identifier ID -->
            <div #getIdentifiers class="col-sm-2 col-md-4 col-lg-3 bg-primary" cdkDrag (cdkDragMoved)="updatePosition()"
              cdkDragBoundary=".parentdiv-boundary">
              <form [formGroup]="getIdentifier" (ngSubmit)="getIdentifierId(getIdentifier)" novalidate>
                <h4 class="titleCreateIdentity">Get Identity</h4>
                <hr>
                <div>
                  <label for="formGroupExampleInput" class="form-label">Email :</label>
                  <input type="email" name="getIdentifierEmail" required formControlName="email" class="input-Form">
                </div>
                <div class="col-6 mx-auto">
                  <button type="submit" class="btn btn-info">Get user ID</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>